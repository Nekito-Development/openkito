package wtf.norma.nekito.exploit.impl.other;

import wtf.norma.nekito.exception.ExploitException;
import wtf.norma.nekito.exploit.Exploit;
import wtf.norma.nekito.exploit.ExploitInfo;
import wtf.norma.nekito.exploit.ExploitType;
import wtf.norma.nekito.exploit.argument.Argument;
import wtf.norma.nekito.helper.PlayerHelper;

@ExploitInfo(
    name = "Spam",
    type = ExploitType.OTHER,
    description = "Some shitty spammer (msg all)"
)
public class SpamExploit extends Exploit {

  public SpamExploit() {
    super(
        new Argument("command, for example: \"/msg\"", 0, String.class),
        new Argument("delay", 1, Long.class),
        new Argument("message", 2, String[].class)
    );
  }

  @Override
  public void execute(Object... args) throws ExploitException {
    if (mc.thePlayer != null && !mc.isSingleplayer()
        && mc.getNetHandler().getPlayerInfoMap() != null) {

      PlayerHelper.getOnlinePlayer()
          .forEach(playerInfo -> {
            if (mc.thePlayer == null || mc.getNetHandler().getPlayerInfoMap() == null) {
              throw new ThreadDeath();
            }

            try {
              mc.thePlayer.sendChatMessage(
                  args[0] + " " + playerInfo.getName() + " " + args[2]);
              System.out
                  .println(args[0] + " " + playerInfo.getName() + " " + args[2]);
              Thread.sleep((Long) args[1]);
            } catch (Exception e) {
              e.printStackTrace();
            }
          });
    }
  }
}
