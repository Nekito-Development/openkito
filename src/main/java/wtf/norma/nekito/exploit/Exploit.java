package wtf.norma.nekito.exploit;

import net.minecraft.client.Minecraft;
import org.apache.commons.lang3.Validate;
import wtf.norma.nekito.exception.ExploitException;
import wtf.norma.nekito.exploit.argument.Argument;
import wtf.norma.nekito.exploit.argument.ArgumentParser;
import wtf.norma.nekito.helper.LazySupplier;

import java.util.function.Supplier;

public abstract class Exploit<T> {

    protected static final Minecraft mc = Minecraft.getMinecraft();

    private final String name;
    private final ExploitType type;
    private final String usage;
    private final String description;
    private final Argument[] arguments;
    private LazySupplier<T> exploitSource;

    public Exploit(Argument... arguments) {
        ExploitInfo exploitInfo = this.getClass().getAnnotation(ExploitInfo.class);
        Validate.notNull(exploitInfo, "CONFUSED ANNOTATION EXCEPTION");

        this.name = exploitInfo.name();
        this.type = exploitInfo.type();
        this.description = exploitInfo.description();

        this.arguments = arguments;
        this.usage = (exploitInfo.usage().isEmpty() ?
                ArgumentParser.createUsage(this) : exploitInfo.usage());
    }

    public Exploit(Supplier<T> exploitSource, Argument... arguments) {
        this(arguments);
        this.exploitSource = new LazySupplier<>(exploitSource);
    }

    public abstract void execute(Object... args) throws ExploitException;

    public final LazySupplier<T> exploitSource() {
        return exploitSource;
    }

    public String getName() {
        return name;
    }

    public ExploitType getType() {
        return type;
    }

    public String getUsage() {
        return usage;
    }

    public String getDescription() {
        return description;
    }

    public Argument[] getArguments() {
        return arguments;
    }
}
